<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Online Linux Subsystem (Standalone)</title>
  <style>
    :root { --bg:#0b0b0b; --panel:#121212; --border:#262626; --fg:#e6e6e6; --muted:#a3a3a3; --accent:#34d399; }
    * { box-sizing: border-box; }
    html, body { height: 100%; margin: 0; background: linear-gradient(#fafafa, #f2f2f2); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
    .wrap { max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    .card { background: white; border: 1px solid #e5e7eb; border-radius: 16px; box-shadow: 0 8px 30px rgba(0,0,0,0.06); }
    .card h1 { margin: 0; padding: 20px 20px 0 20px; font-size: 22px; font-weight: 700; }
    .card .sub { color: #6b7280; padding: 0 20px 12px 20px; font-size: 13px; }
    .term { margin: 16px; border: 1px solid var(--border); background: var(--bg); color: var(--fg); border-radius: 14px; overflow: hidden; }
    .term .title { display:flex; align-items:center; justify-content:space-between; padding: 10px 12px; background: #0f0f0f; border-bottom: 1px solid var(--border); color: var(--muted); font-size: 12px; }
    .lights { display:flex; gap:8px; }
    .light { width:12px; height:12px; border-radius:999px; }
    .red{background:#ef4444}.yellow{background:#f59e0b}.green{background:#10b981}
    .screen { height: 480px; overflow:auto; padding: 10px 12px; }
    .line { white-space: pre-wrap; word-break: break-word; }
    .in { color: #d1d5db; }
    .sys { color: #9ca3af; }
    .prompt { color: var(--accent); user-select: none; }
    .inputRow { display:flex; gap: 8px; align-items:center; margin-top: 6px; }
    .cmd { flex:1; background: transparent; border: none; color: var(--fg); outline: none; caret-color: var(--accent); font: inherit; }
    .toolbar { display:flex; gap:10px; border-top:1px solid var(--border); padding: 8px 10px; }
    .btn { font: inherit; color:#111; background:#f3f4f6; border:1px solid #e5e7eb; padding:6px 10px; border-radius:10px; cursor:pointer }
    .btn:active { transform: translateY(1px); }
    code.kbd { background:#111827; color:#e5e7eb; padding:2px 6px; border-radius:6px; border:1px solid #1f2937; }
    .about { padding: 16px 20px; }
    .about h2 { margin:0 0 8px 0; font-size: 18px; }
    .about ul { margin: 8px 0 0 20px; color:#374151; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Online Linux Subsystem (OLS)</h1>
      <div class="sub">Standalone, zero-dependency Ubuntu-like terminal (simulated). Drop this file into your repo and link it from Markdown.</div>
      <div class="term" id="ols">
        <div class="title">
          <div class="lights"><div class="light red"></div><div class="light yellow"></div><div class="light green"></div></div>
          <div>OLS Shell • Ubuntu 22.04 (sim)</div>
        </div>
        <div class="screen" id="screen"></div>
        <div class="toolbar">
          <button class="btn" id="clearBtn">Clear</button>
          <button class="btn" id="helpBtn">Help</button>
          <button class="btn" id="fetchBtn">Neofetch</button>
          <button class="btn" id="copyBtn" style="margin-left:auto">Copy Output</button>
        </div>
      </div>
      <div class="about">
        <h2>Tips</h2>
        <div>Try <code class="kbd">help</code>, <code class="kbd">ls</code>, <code class="kbd">cd projects</code>, <code class="kbd">cat readme.txt</code>, <code class="kbd">uname -a</code>, <code class="kbd">neofetch</code>, <code class="kbd">nano notes.txt</code>.</div>
        <ul>
          <li>No build, no npm, no frameworks. Works on GitHub Pages.</li>
          <li><strong>nano</strong> opens a new tab; click <em>Save & Close</em> to write changes back.</li>
          <li><strong>sudo</strong> simulates privilege (re-runs the command without elevation).</li>
        </ul>
      </div>
    </div>
  </div>

  <script>
  (function(){
    // ===== In-memory filesystem =====
    function createFS(){
      return { type:"dir", name:"/", children:{
        home:{ type:"dir", name:"home", children:{
          ols:{ type:"dir", name:"ols", children:{
            "readme.txt":{ type:"file", name:"readme.txt", content:
              "Welcome to OLS (Online Linux Subsystem)!\nThis is a sandboxed, client-side Ubuntu-like terminal.\nType 'help' to see supported commands.\n" },
            projects:{ type:"dir", name:"projects", children:{
              "hello.py":{ type:"file", name:"hello.py", content:"print('Hello from OLS!')\n" }
            }}
          }}
        }},
        etc:{ type:"dir", name:"etc", children:{
          hostname:{ type:"file", name:"hostname", content:"ols-ubuntu" },
          osrelease:{ type:"file", name:"osrelease", content:"NAME=\"Ubuntu\"\nVERSION=\"22.04.4 LTS (Jammy Jellyfish)\"\nID=ubuntu\n" }
        }},
        bin:{ type:"dir", name:"bin", children:{} },
        usr:{ type:"dir", name:"usr", children:{
          share:{ type:"dir", name:"share", children:{
            "neofetch.txt":{ type:"file", name:"neofetch.txt", content:
`      _   _
     | | | |  OLS Ubuntu 22.04 (simulated)
  ___| |_| | ___   _ __   ___
 / _ \\ __| |/ / | | '_ \\ / _ \\
|  __/ |_|   <| |_| | | |  __/
 \\___|\\__|_|\\_\\\\__,_| |_|\\___|

CPU: Browser JS Engine
Mem: Your RAM :)
Shell: OLS sh (sim)
` }
          }}
        }},
        var:{ type:"dir", name:"var", children:{} },
        tmp:{ type:"dir", name:"tmp", children:{} }
      }};
    }

    function pathJoin(){
      var parts = Array.from(arguments).join("/").replace(/\/+/, "/");
      var segs = parts.replace(/\/+/, "/").replace(/\/+/, "/").split("/");
      // robust collapse
      segs = parts.replace(/\/+g/, "/").split("/"); // fallback for older engines not needed, but safe
      var out=[];
      for (var i=0;i<segs.length;i++){
        var s=segs[i]; if(!s||s===".") continue; if(s==="..") out.pop(); else out.push(s);
      }
      return "/"+out.join("/");
    }

    function pathJoinSafe(){ // correct version
      var parts = Array.from(arguments).join("/").replace(/\/+g/, "/");
      var segs = parts.split("/");
      var out=[]; for (var i=0;i<segs.length;i++){ var s=segs[i]; if(!s||s===".") continue; if(s==="..") out.pop(); else out.push(s); }
      return "/"+out.join("/");
    }

    // Use safe version everywhere below
    var join = pathJoinSafe;

    function getNode(fs, p){
      var parts = p.split("/").filter(Boolean);
      var node = fs;
      for (var i=0;i<parts.length;i++){
        var name = parts[i];
        if (node.type !== "dir" || !node.children[name]) return null;
        node = node.children[name];
      }
      return node;
    }

    function ensurePath(fs, p, asDir){
      var parts = p.split("/").filter(Boolean);
      var node = fs;
      for (var i=0;i<parts.length;i++){
        var name = parts[i];
        if (!node.children[name]){
          node.children[name] = (asDir || i < parts.length-1) ? {type:"dir", name, children:{}} : {type:"file", name, content:""};
        }
        node = node.children[name];
      }
      return node;
    }

    function escapeHTML(s){
      return String(s).replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/\"/g, "&quot;").replace(/'/g, "&#39;");
    }

    // ===== Terminal state =====
    var DEFAULT_USER = "ols"; var DEFAULT_HOST = "ubuntu";
    var fsRoot = createFS();
    var cwd = "/home/ols";
    var lines = [ {type:"sys", text:"Welcome to OLS — type 'help' to begin."} ];
    var history = []; var histIndex = -1;

    var screen = document.getElementById('screen');

    function render(){
      // Rebuild DOM
      screen.innerHTML = '';
      for (var i=0;i<lines.length;i++){
        var d = document.createElement('div');
        d.className = 'line ' + (lines[i].type==='in'?'in':lines[i].type==='sys'?'sys':'');
        d.textContent = lines[i].text;
        screen.appendChild(d);
      }
      // input row
      var row = document.createElement('div'); row.className='inputRow';
      var prompt = document.createElement('span'); prompt.className='prompt'; prompt.textContent = DEFAULT_USER+"@"+DEFAULT_HOST+":"+cwd.replace(/^\/home\/ols/,"~")+"$";
      var input = document.createElement('input'); input.className='cmd'; input.autocapitalize='none'; input.autocomplete='off'; input.spellcheck=false;
      input.addEventListener('keydown', onKeyDown(input));
      row.appendChild(prompt); row.appendChild(input);
      screen.appendChild(row);
      // scroll & focus
      screen.scrollTop = screen.scrollHeight; input.focus();
    }

    function print(t){ lines.push({type:'out', text: String(t||'')}); render(); }
    function printMulti(arr){ for (var i=0;i<arr.length;i++) lines.push({type:'out', text:arr[i]}); render(); }

    function resolvePath(p){
      if (!p || p==='.') return cwd;
      if (p[0]==='/') return join(p);
      if (p==='~' || (p.length>2 && p.slice(0,2)==='~/')) return join('/home/ols', p.replace(/^~\/?/, ''));
      return join(cwd, p);
    }

    function handle(raw){
      var line = (raw||'').replace(/\s+$/,'');
      lines.push({type:'in', text: DEFAULT_USER+"@"+DEFAULT_HOST+":"+cwd.replace(/^\/home\/ols/,"~")+"$ "+line});
      if (!line.trim()) { render(); return; }

      var toks = line.match(/(?:\"[^\"]*\"|'[^']*'|\S+)/g) || [];
      var cmd = (toks[0]||'').replace(/\"/g,'').replace(/'/g,'');
      var args = toks.slice(1).map(function(t){ return t.replace(/^['\"]|['\"]$/g,''); });

      switch(cmd){
        case 'help': print(
`Supported commands:
  help                 Show this help
  clear                Clear the terminal
  echo [text]          Print text
  pwd                  Print working directory
  ls [path]            List directory
  cd [path]            Change directory
  cat <file>           Print file contents
  touch <file>         Create empty file
  mkdir <dir>          Create directory
  rm <file>            Remove file
  rmdir <dir>          Remove empty directory
  uname [-a]           System info
  whoami               Show current user
  date                 Show date/time
  neofetch             Fancy system summary
  ps                   Show fake process list
  top                  Show fake resource usage
  ifconfig             Show fake network info
  apt, apt-get         Simulated package manager
  man <cmd>            Minimal manual entries
  sudo                 Simulated privilege runner
  nano <file>          Open editor in a new tab`); break;
        case 'clear': lines=[]; break;
        case 'echo': print(args.join(' ')); break;
        case 'pwd': print(cwd); break;
        case 'ls': {
          var target = args[0] ? resolvePath(args[0]) : cwd;
          var node = getNode(fsRoot, target);
          if (!node) { print("ls: cannot access '"+(args[0]||target)+"': No such file or directory"); break; }
          if (node.type==='file'){ print(args[0]||node.name); break; }
          var list = Object.keys(node.children).map(function(k){ var c=node.children[k]; return c.type==='dir'?c.name+'/':c.name; }).sort();
          print(list.join('  '));
          break; }
        case 'cd': {
          var tgt = resolvePath(args[0] || '/home/ols');
          var nd = getNode(fsRoot, tgt);
          if (!nd) { print('cd: '+(args[0]||'')+': No such file or directory'); break; }
          if (nd.type!=='dir'){ print('cd: '+(args[0]||'')+': Not a directory'); break; }
          cwd = tgt; break; }
        case 'cat': {
          if (!args[0]) { print('cat: missing file operand'); break; }
          var p = resolvePath(args[0]); var n = getNode(fsRoot, p);
          if (!n) { print('cat: '+args[0]+': No such file or directory'); break; }
          if (n.type!=="file") { print('cat: '+args[0]+': Is a directory'); break; }
          print(n.content||''); break; }
        case 'touch': {
          if (!args[0]) { print('touch: missing file operand'); break; }
          var tp = resolvePath(args[0]); var dpath = tp.split('/').slice(0,-1).join('/')||'/'; var base = tp.split('/').pop();
          var dir = getNode(fsRoot, dpath); if (!dir || dir.type!=="dir"){ print("touch: cannot touch '"+args[0]+"': No such file or directory"); break; }
          dir.children[base] = dir.children[base] || {type:'file', name:base, content:''};
          break; }
        case 'mkdir': {
          if (!args[0]){ print('mkdir: missing operand'); break; }
          var mp = resolvePath(args[0]); var parentPath = mp.split('/').slice(0,-1).join('/')||'/'; var base2 = mp.split('/').pop();
          var parent = getNode(fsRoot, parentPath);
          if (!parent || parent.type!=="dir"){ print("mkdir: cannot create directory '"+args[0]+"': No such file or directory"); break; }
          if (parent.children[base2]){ print("mkdir: cannot create directory '"+args[0]+"': File exists"); break; }
          parent.children[base2] = {type:'dir', name:base2, children:{}}; break; }
        case 'rm': {
          if (!args[0]){ print('rm: missing operand'); break; }
          var rp = resolvePath(args[0]); var rpp = rp.split('/').slice(0,-1).join('/')||'/'; var rbase = rp.split('/').pop();
          var rpar = getNode(fsRoot, rpp);
          if (!rpar || rpar.type!=="dir" || !rpar.children[rbase]){ print("rm: cannot remove '"+args[0]+"': No such file or directory"); break; }
          if (rpar.children[rbase].type==='dir'){ print("rm: cannot remove '"+args[0]+"': Is a directory"); break; }
          delete rpar.children[rbase]; break; }
        case 'rmdir': {
          if (!args[0]){ print('rmdir: missing operand'); break; }
          var dp = resolvePath(args[0]); var dpp = dp.split('/').slice(0,-1).join('/')||'/'; var dbase = dp.split('/').pop();
          var dpar = getNode(fsRoot, dpp);
          if (!dpar || dpar.type!=="dir" || !dpar.children[dbase]){ print("rmdir: failed to remove '"+args[0]+"': No such file or directory"); break; }
          var node2 = dpar.children[dbase];
          if (node2.type!=="dir"){ print("rmdir: failed to remove '"+args[0]+"': Not a directory"); break; }
          if (Object.keys(node2.children).length){ print("rmdir: failed to remove '"+args[0]+"': Directory not empty"); break; }
          delete dpar.children[dbase]; break; }
        case 'uname': if (args.indexOf('-a')>-1) print('Linux ols-ubuntu 5.15.0-sim #1 SMP PREEMPT OLS x86_64 GNU/Linux'); else print('Linux'); break;
        case 'whoami': print(DEFAULT_USER); break;
        case 'date': print(String(new Date())); break;
        case 'neofetch': { var nodeNF = getNode(fsRoot, '/usr/share/neofetch.txt'); print(nodeNF && nodeNF.content || 'neofetch: not found'); break; }
        case 'ps': printMulti(['  PID TTY          TIME CMD','    1 pts/0    00:00:00 init','  133 pts/0    00:00:00 ols-sh','  247 pts/0    00:00:00 web']); break;
        case 'top': printMulti(['top - 00:00:00 up 0 min,  1 user,  load average: 0.23, 0.19, 0.12','Tasks:  23 total,   1 running, 22 sleeping,   0 stopped,   0 zombie','%Cpu(s):  3.0 us,  2.0 sy,  0.0 ni, 92.0 id,  3.0 wa,  0.0 hi,  0.0 si,  0.0 st','MiB Mem :  16384.0 total,   234.1 free,  6150.0 used,  9999.9 buff/cache']); break;
        case 'ifconfig': printMulti(['eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500','        inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255','lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536','        inet 127.0.0.1  netmask 255.0.0.0']); break;
        case 'man': {
          var page = (args[0]||'').toLowerCase();
          var man = {
            help: 'help - list available commands',
            ls: 'ls - list directory contents\nUsage: ls [PATH]',
            cd: 'cd - change directory\nUsage: cd [PATH]',
            cat: 'cat - print file content\nUsage: cat FILE',
            echo: 'echo - print text\nUsage: echo [TEXT]',
            neofetch: 'neofetch - system info in ASCII art',
            apt: 'apt - simulated package manager (offline)',
            sudo: 'sudo - simulate privilege elevation\nUsage: sudo <command>',
            nano: 'nano - open a simple editor in a new tab\nUsage: nano <file>'
          };
          print(man[page] || ('No manual entry for '+page));
          break; }
        case 'apt':
        case 'apt-get': {
          var sub = args[0];
          if (!sub){ print(cmd+': missing subcommand (try: update, install, search)'); break; }
          if (sub==='update'){ print('Get:1 OLS universe InRelease [simulated]\nReading package lists... Done'); break; }
          if (sub==='install'){ print('E: Unable to locate package (network disabled in sandbox)'); break; }
          if (sub==='search'){ print('Sorting... Done\nFull Text Search... Done (simulated)'); break; }
          print(cmd+": '"+sub+"' not implemented in OLS"); break; }
        case 'sudo': if (!args.length) print('usage: sudo <command>'); else handle(args.join(' ')); break;
        case 'nano': {
          if (!args[0]){ print('nano: missing file operand'); break; }
          var filePath = resolvePath(args[0]);
          var dirPath = filePath.split('/').slice(0,-1).join('/')||'/'; var base = filePath.split('/').pop();
          var node = getNode(fsRoot, filePath);
          if (!node){
            var d = getNode(fsRoot, dirPath);
            if (!d || d.type!=="dir"){ print('nano: '+args[0]+': No such file or directory'); break; }
            d.children[base] = {type:'file', name:base, content:''}; node = d.children[base];
          }
          if (node.type!=="file"){ print('nano: '+args[0]+': Is a directory'); break; }
          var safe = escapeHTML(node.content||'');
          var html = "<!DOCTYPE html><html><head><meta charset=\"utf-8\"/><title>nano - "+escapeHTML(args[0])+
            "</title></head><body style=\"margin:0;display:flex;flex-direction:column;height:100%;font-family:ui-monospace,monospace;\">"+
            "<header style=\"padding:8px 12px;border-bottom:1px solid #ddd;\">Editing: <code>"+escapeHTML(filePath)+"</code></header>"+
            "<textarea id=\"editor\" style=\"flex:1;font-family:inherit;font-size:14px;padding:12px;border:none;outline:none;\">"+safe+"</textarea>"+
            "<div style=\"display:flex;gap:8px;padding:8px;border-top:1px solid #ddd;\">"+
            "<button id=\"saveBtn\">Save & Close</button>"+
            "<button id=\"cancelBtn\">Cancel</button>"+
            "</div>"+
            "<script>(function(){var s=document.getElementById('saveBtn'),c=document.getElementById('cancelBtn');s.onclick=function(){var t=document.getElementById('editor').value;if(window.opener){window.opener.postMessage({type:'nano-save',path:"+JSON.stringify(filePath)+",content:t},'*');}window.close();};c.onclick=function(){window.close();};})();<\/script>"+
            "</body></html>";
          var w = window.open('', 'nanoEditor', 'width=900,height=650');
          if (w){ w.document.open(); w.document.write(html); w.document.close(); }
          else { print('nano: popup blocked by browser'); }
          break; }
        case 'selftest': {
          var ok = true; // quick tests
          function t(name, cond){ if(!cond){ ok=false; print('TEST FAIL: '+name); } }
          t('path join', join('/a//b///c')==='/a/b/c');
          var fs = createFS(); ensurePath(fs,'/home/ols/tmp',true); ensurePath(fs,'/home/ols/tmp/file.txt',false); fs.children.home.children.ols.children['tmp'].children['file.txt'].content='x';
          t('file write', getNode(fs,'/home/ols/tmp/file.txt').content==='x');
          print(ok? 'All tests passed.' : 'Some tests failed.');
          break; }
        default: if (cmd.trim()) print(cmd+': command not found');
      }
      render();
    }

    function onKeyDown(input){
      return function(e){
        if (e.key==='Enter'){
          var val = input.value; history.push(val); histIndex=-1; handle(val);
        } else if (e.key==='ArrowUp'){
          e.preventDefault(); if (history.length===0) return; var idx = histIndex<0?history.length-1:Math.max(0,histIndex-1); histIndex=idx; input.value = history[idx]||'';
        } else if (e.key==='ArrowDown'){
          e.preventDefault(); if (history.length===0) return; var idx = histIndex<0?-1:Math.min(history.length-1,histIndex+1); histIndex=idx; input.value = idx===-1? '': (history[idx]||'');
        }
      }
    }

    // Receive nano saves
    window.addEventListener('message', function(e){
      if (e.data && e.data.type==='nano-save'){
        var node = getNode(fsRoot, e.data.path);
        if (node && node.type==='file'){ node.content = String(e.data.content||''); print('Saved '+e.data.path); render(); }
      }
    });

    // toolbar
    document.getElementById('clearBtn').onclick = function(){ lines=[]; render(); };
    document.getElementById('helpBtn').onclick = function(){ handle('help'); };
    document.getElementById('fetchBtn').onclick = function(){ handle('neofetch'); };
    document.getElementById('copyBtn').onclick = function(){
      var text = lines.map(function(l){ return l.text; }).join('\n');
      navigator.clipboard && navigator.clipboard.writeText(text);
    };

    render();
  })();
  </script>
</body>
</html>
